<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Bucin üíñ</title>
  <style>
    /* CSS Reset & Basic */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #ECE5DD; display: flex; flex-direction: column; height: 100vh; }
    
    /* Tampilan Login */
    #loginScreen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #ECE5DD; display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 1000;
    }
    .login-box {
      background: white; padding: 30px; border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px;
    }
    .login-box h2 { color: #075E54; margin-bottom: 20px; font-size: 24px; }
    .login-box input {
      width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc;
      border-radius: 8px; font-size: 16px; text-align: center; outline: none;
    }
    .login-box button {
      width: 100%; padding: 12px; background: #075E54; color: white;
      border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s;
    }
    .login-box button:disabled { background: #999; }
    #errorMsg { color: #d32f2f; margin-top: 10px; display: none; font-size: 14px; font-weight: bold; }

    /* Header Aplikasi */
    header {
      background-color: #075E54; color: white; padding: 15px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
    }
    .header-left { display: flex; align-items: center; gap: 10px; }
    #headerAvatar { width: 40px; height: 40px; border-radius: 50%; background: white; object-fit: cover; }
    .header-title { font-weight: bold; font-size: 18px; }

    /* Area Chat */
    main { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; position: relative; font-size: 15px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .msg-me { background-color: #DCF8C6; align-self: flex-end; border-bottom-right-radius: 0; }
    .msg-partner { background-color: white; align-self: flex-start; border-bottom-left-radius: 0; }
    
    /* Area Ketik Pesan */
    footer { background: #f0f0f0; padding: 10px; display: flex; gap: 10px; align-items: center; }
    footer input { flex: 1; padding: 12px 15px; border: none; border-radius: 20px; outline: none; font-size: 15px; }
    footer button { background: #075E54; color: white; border: none; padding: 12px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }

    /* Pop-up Pencarian YouTube */
    #searchModal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000;
    }
    .modal-content {
      background: white; width: 90%; max-width: 400px; border-radius: 15px; padding: 20px;
      max-height: 80vh; display: flex; flex-direction: column;
    }
    .modal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: #075E54; font-size: 18px; }
    .close-btn { cursor: pointer; color: #d32f2f; font-size: 20px; }
    #searchResults { overflow-y: auto; flex: 1; }
    .result-item {
      display: flex; gap: 10px; padding: 10px; border-bottom: 1px solid #ddd; cursor: pointer; align-items: center; transition: background 0.2s;
    }
    .result-item:hover { background: #f1f1f1; }
    .result-item img { width: 80px; height: 60px; object-fit: cover; border-radius: 8px; }
    .result-item-info { flex: 1; font-size: 14px; }

    /* Pop-up Estetik (Toast) */
    #customToast {
      visibility: hidden; min-width: 250px; background-color: #075E54; color: white;
      text-align: center; border-radius: 20px; padding: 12px 20px;
      position: fixed; z-index: 9999; left: 50%; bottom: 20px;
      transform: translateX(-50%); font-size: 14px; font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3); opacity: 0; 
      transition: opacity 0.4s, bottom 0.4s;
    }
    #customToast.show { visibility: visible; opacity: 1; bottom: 80px; }

    /* Pemutar YouTube (Disembunyikan) */
    #playerContainer { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body>

  <div id="loginScreen">
    <div class="login-box">
      <h2>Portal Bucin üíñ</h2>
      <input type="password" id="inputCode" placeholder="Masukkan Kode Akses...">
      <button id="btnLogin" onclick="doLogin()">MASUK</button>
      <div id="errorMsg"></div>
    </div>
  </div>

  <div id="appScreen" style="display: none; flex-direction: column; height: 100%;">
    <header>
      <div class="header-left">
        <img id="headerAvatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Avatar">
        <span class="header-title" id="partnerNameDisplay">Si Doi</span>
      </div>
      <div>üéµ</div>
    </header>

    <main id="chatBox">
      <div class="message msg-partner">Halo sayang! Coba ketik <b>/play nama lagu</b> untuk muter musik berdua ya. üé∂</div>
    </main>

    <footer>
      <input type="text" id="chatInput" placeholder="Ketik pesan atau /play lagu..." onkeypress="handleEnter(event)">
      <button onclick="sendMessage()">KIRIM</button>
    </footer>
  </div>

  <div id="searchModal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Hasil Pencarian üîé</span>
        <span class="close-btn" onclick="closeModal()">‚úñ</span>
      </div>
      <div id="searchResults"></div>
    </div>
  </div>

  <div id="customToast"></div>

  <div id="playerContainer">
    <div id="ytplayer"></div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // ==========================================
    // 1. ISI DENGAN API KEY YOUTUBE KAMU DI SINI
    // ==========================================
    const YOUTUBE_API_KEY = "AIzaSyDyjdnaA2Ipa_j6-pWN4K4j-42_ja-LH24"; 

    // Variabel Global
    let myName = "";
    let partnerName = "";
    let ytPlayer;
    let isYtReady = false;

    // --- FUNGSI TOAST ESTETIK ---
    function showToast(msg) {
      const toast = document.getElementById("customToast");
      toast.innerText = msg;
      toast.classList.add("show");
      // Sembunyikan otomatis setelah 3.5 detik
      setTimeout(() => { toast.classList.remove("show"); }, 3500);
    }

    // --- FUNGSI LOGIN (TIDAK BUTUH GOOGLE SCRIPT LAGI) ---
    function doLogin() {
      const btn = document.getElementById('btnLogin');
      const code = document.getElementById('inputCode').value.trim();
      const err = document.getElementById('errorMsg');

      if (!code) {
        err.innerText = "Kode akses tidak boleh kosong!";
        err.style.display = "block";
        return;
      }

      // Trik "Pancingan" agar browser mengizinkan suara keluar (Autoplay Bypass)
      try {
        if (isYtReady && typeof ytPlayer !== 'undefined') {
           ytPlayer.unMute();
           ytPlayer.setVolume(100);
           ytPlayer.playVideo();
           setTimeout(() => { ytPlayer.pauseVideo(); }, 500); 
        }
      } catch (e) { console.log("Audio unlock tertunda..."); }

      btn.disabled = true; 
      btn.innerText = "Processing..."; 
      err.style.display = "none";
      
      // ==========================================
      // 2. UBAH KODE AKSES DAN NAMA KALIAN DI SINI
      // ==========================================
      const users = {
        "123456": { success: true, name: "NamaCowok", partner: "NamaCewek", role: "cowok" },
        "654321": { success: true, name: "NamaCewek", partner: "NamaCowok", role: "cewek" }
      };

      // Simulasi loading sebentar agar terasa natural
      setTimeout(() => {
        if (users[code]) {
          let res = users[code];
          myName = res.name; 
          partnerName = res.partner;
          
          // Ganti gambar profil berdasarkan yang login
          const avatarImg = document.getElementById('headerAvatar');
          avatarImg.src = (res.role === 'cowok') ? "https://cdn-icons-png.flaticon.com/512/4140/4140047.png" : "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";
          
          // Ganti nama profil atas
          document.getElementById('partnerNameDisplay').innerText = partnerName;
          
          initApp(); 
        } else {
          err.innerText = "Kode salah! Coba lagi.";
          err.style.display = "block";
          btn.disabled = false; 
          btn.innerText = "MASUK";
        }
      }, 500);
    }

    function initApp() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appScreen').style.display = 'flex';
      showToast("Berhasil masuk! Selamat datang, " + myName + " üíñ");
    }

    // --- FUNGSI YOUTUBE PLAYER & PENCARIAN ---
    function onYouTubeIframeAPIReady() {
      ytPlayer = new YT.Player('ytplayer', {
        height: '200', width: '300',
        videoId: '', 
        playerVars: { 'playsinline': 1, 'controls': 0 },
        events: {
          'onReady': function(event) { isYtReady = true; console.log("YT Player Siap!"); },
          'onError': function(event) { console.log("YT Error: " + event.data); }
        }
      });
    }

    async function searchYouTube(query) {
      showToast("Mencari lagu: " + query + " ‚è≥");
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&key=${YOUTUBE_API_KEY}&maxResults=5`;
      
      try {
        const response = await fetch(url);
        const data = await response.json();
        
        if(data.error) {
          showToast("Error API: " + data.error.message);
          return;
        }
        displaySearchResults(data.items);
      } catch (error) {
        showToast("Gagal mencari lagu. Cek koneksi / API Key.");
      }
    }

    function displaySearchResults(items) {
      const resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML = "";
      
      if (!items || items.length === 0) {
        resultsDiv.innerHTML = "<p style='text-align:center; padding: 20px;'>Lagu tidak ditemukan üò¢</p>";
      } else {
        items.forEach(item => {
          const vidId = item.id.videoId;
          const title = item.snippet.title;
          const thumb = item.snippet.thumbnails.default.url;
          const channel = item.snippet.channelTitle;

          const div = document.createElement('div');
          div.className = "result-item";
          // Ketika lagu diklik
          div.onclick = () => playFromList(vidId, title);
          
          div.innerHTML = `
            <img src="${thumb}" alt="thumb">
            <div class="result-item-info">
              <strong>${title}</strong><br>
              <span style="color: gray; font-size: 12px;">${channel}</span>
            </div>
          `;
          resultsDiv.appendChild(div);
        });
      }
      document.getElementById('searchModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('searchModal').style.display = 'none';
    }

    // --- FITUR AUTO-RETRY KETIKA MEMUTAR LAGU ---
    function playFromList(vidId, title) {
      // JIKA PLAYER BELUM SIAP: Munculkan pop-up & coba lagi otomatis 1.5 detik kemudian!
      if (!isYtReady || !ytPlayer || typeof ytPlayer.loadVideoById !== 'function') { 
        showToast("‚è≥ Sabar sayang, pemutar lagi disiapin... (otomatis muter kok!)"); 
        
        // Memanggil fungsinya sendiri lagi nanti (Looping sampai berhasil)
        setTimeout(() => { playFromList(vidId, title); }, 1500); 
        return; 
      }

      // JIKA SUDAH SIAP: Langsung eksekusi pemutaran
      try {
        ytPlayer.unMute();
        ytPlayer.setVolume(100);
        ytPlayer.loadVideoById(vidId);
        ytPlayer.playVideo();
        
        closeModal();
        showToast("üé∂ Memutar: " + title);
        
        // Menampilkan pesan ke dalam chatbox bahwa kamu memutar lagu
        addMessage("<i>Sedang memutar lagu: " + title + "</i> üéµ", "me");
      } catch(e) {
        showToast("Gagal memutar lagu. Coba lagi ya.");
      }
    }

    // --- FUNGSI CHAT UI ---
    function handleEnter(e) {
      if (e.key === 'Enter') sendMessage();
    }

    function sendMessage() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;

      input.value = "";

      // Cek apakah ketikan depannya adalah /play
      if (text.toLowerCase().startsWith('/play ')) {
        const query = text.substring(6).trim();
        addMessage(text, "me"); // Tampilkan perintah di chat
        if(query) {
          searchYouTube(query);
        }
        return;
      }

      // Kirim pesan biasa ke layar chat
      addMessage(text, "me");
      
      // Catatan: Jika Firebase Chat kamu sudah siap, kamu bisa tambahkan kode "push" Firebase-nya di bawah ini!
    }

    function addMessage(text, sender) {
      const box = document.getElementById('chatBox');
      const div = document.createElement('div');
      div.className = `message ${sender === 'me' ? 'msg-me' : 'msg-partner'}`;
      div.innerHTML = text;
      box.appendChild(div);
      
      // Auto-scroll layar chat ke paling bawah
      box.scrollTop = box.scrollHeight;
    }
  </script>
</body>
</html>

